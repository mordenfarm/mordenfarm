<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | AlfaOctal Campus Content Management</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Firebase SDK Integration -->
    <script>
        // Secure Firebase configuration using placeholders
        const firebaseConfig = {
            apiKey: "%%FIREBASE_API_KEY%%",
            authDomain: "%%FIREBASE_AUTH_DOMAIN%%",
            databaseURL: "https://mordern-farm-default-rtdb.firebaseio.com",
            projectId: "%%FIREBASE_PROJECT_ID%%",
            storageBucket: "%%FIREBASE_STORAGE_BUCKET%%",
            messagingSenderId: "%%FIREBASE_MESSAGING_SENDER_ID%%",
            appId: "%%FIREBASE_APP_ID%%",
            measurementId: "%%FIREBASE_MEASUREMENT_ID%%"
        };
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        try {
            const app = initializeApp(firebaseConfig);
            window.firebase = {
                app,
                auth: getAuth(app),
                db: getFirestore(app),
                storage: getStorage(app),
                onAuthStateChanged, signInWithEmailAndPassword, signOut,
                doc, getDoc, setDoc, collection, getDocs, addDoc, deleteDoc
            };
            console.log("Firebase Initialized for Admin Panel.");
        } catch (error) {
            console.error("Firebase initialization failed:", error);
        }
    </script>

    <style>
        :root {
            --color-primary: #e53935;
            --color-success: #43a047;
            --bg-dark: #121212;
            --bg-light: #1e1e1e;
            --bg-card: #2a2a2a;
            --text-primary: #f5f5f5;
            --text-secondary: #b0b0b0;
            --border-color: #424242;
            --border-radius: 8px;
            --font-primary: 'Inter', sans-serif;
            --transition: all 0.3s ease;
            --sidebar-width: 260px;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: var(--font-primary);
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-size: 16px;
        }

        /* --- Login Overlay --- */
        #login-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px); z-index: 1000; display: flex;
            align-items: center; justify-content: center;
        }
        #login-container {
            width: 100%; max-width: 400px; padding: 2rem; background: var(--bg-light);
            border: 1px solid var(--border-color); border-radius: var(--border-radius);
            text-align: center;
        }
        #login-container h1 { margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1rem; text-align: left; }
        .form-input {
            width: 100%; padding: 0.8rem; background: var(--bg-dark);
            border: 1px solid var(--border-color); border-radius: 4px;
            color: var(--text-primary); font-size: 1rem;
        }
        .form-input:focus { border-color: var(--color-primary); outline: none; }
        .btn {
            width: 100%; padding: 0.8rem; border: none; border-radius: 4px;
            font-weight: 600; font-size: 1rem; cursor: pointer; transition: var(--transition);
        }
        .btn-primary { background-color: var(--color-primary); color: white; }
        .btn-primary:hover { background-color: #c62828; }
        .error-text { color: var(--color-primary); margin-top: 1rem; font-weight: 500; }
        
        /* --- Admin Panel Layout --- */
        #admin-panel { display: none; height: 100vh; display: flex; }
        
        .sidebar {
            width: var(--sidebar-width); background-color: var(--bg-light);
            padding: 1.5rem 1rem; border-right: 1px solid var(--border-color);
            transition: transform 0.3s ease-in-out; display: flex; flex-direction: column;
        }
        .sidebar-header { text-align: center; margin-bottom: 2rem; }
        .sidebar-header img { max-width: 150px; }

        .sidebar-nav { list-style: none; }
        .sidebar-nav a {
            display: flex; align-items: center; padding: 0.9rem;
            color: var(--text-secondary); text-decoration: none; border-radius: 6px;
            margin-bottom: 0.5rem; transition: var(--transition);
        }
        .sidebar-nav a:hover { background-color: var(--bg-card); color: var(--text-primary); }
        .sidebar-nav a.active { background-color: var(--color-primary); color: white; }
        .sidebar-nav i { width: 30px; font-size: 1rem; text-align: center; }
        .sidebar-nav span { font-weight: 500; }

        .main-content { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; }
        .main-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 2rem; background: var(--bg-light);
            border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 10;
        }
        .main-header h1 { font-size: 1.5rem; }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .btn-logout, .btn-save {
            padding: 0.6rem 1.2rem; border-radius: 4px; font-weight: 600;
            cursor: pointer; transition: var(--transition); width: auto;
        }
        .btn-logout { background: none; border: 1px solid var(--border-color); color: var(--text-secondary); }
        .btn-logout:hover { border-color: var(--color-primary); color: var(--color-primary); }
        
        #mobile-menu-btn { display: none; }

        .content-wrapper { padding: 2rem; }
        .page-view { display: none; }
        .page-view.active { display: block; }

        .content-section {
            background: var(--bg-card); padding: 1.5rem;
            border-radius: var(--border-radius); margin-bottom: 2rem;
        }
        .content-section h2 { margin-bottom: 1.5rem; font-size: 1.5rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        textarea.form-input { min-height: 120px; resize: vertical; }

        /* --- New Notes Section --- */
        .note-card {
            background: var(--bg-light); border: 1px solid var(--border-color);
            border-radius: 6px; margin-bottom: 1rem; overflow: hidden;
        }
        .note-card-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem; cursor: pointer; user-select: none;
        }
        .note-card-header:hover { background-color: #3c3c3c; }
        .note-card-header h3 { font-size: 1.1rem; flex-grow: 1; }
        .note-card-actions { display: flex; align-items: center; gap: 0.5rem; }
        .note-card-actions .toggle-icon { transition: transform 0.3s ease; }
        .note-card-actions button {
            background: none; border: none; color: var(--text-secondary);
            cursor: pointer; font-size: 1.1rem; padding: 0.3rem;
        }
        .note-card-actions button:hover { color: var(--color-primary); }
        .note-card-body {
            max-height: 0; overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
        }
        .note-card-body .form-group { padding: 0 1rem; }
        .note-card.is-open .note-card-body {
            max-height: 1000px; /* Large value to allow content to expand */
            padding-bottom: 1rem;
        }
        .note-card.is-open .toggle-icon { transform: rotate(180deg); }

        /* Item lists (for videos) */
        .item-list { list-style: none; margin-top: 1.5rem; }
        .item-card {
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-light); padding: 1rem; border-radius: 4px;
            margin-bottom: 0.5rem; border: 1px solid var(--border-color);
        }
        .item-info { flex-grow: 1; overflow: hidden; }
        .item-info strong { display: block; color: var(--text-primary); }
        .item-info span { font-size: 0.9rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .btn-delete {
            background: #424242; color: var(--text-primary); padding: 0.5rem 0.8rem;
            border: none; border-radius: 4px; font-weight: 600; cursor: pointer; flex-shrink: 0;
        }
        .btn-delete:hover { background: var(--color-primary); }

        #save-status {
            position: fixed; bottom: 20px; right: 20px; z-index: 500;
            padding: 1rem 1.5rem; border-radius: var(--border-radius);
            font-weight: 600; color: white; transition: var(--transition);
            transform: translateY(200%); opacity: 0;
        }
        #save-status.saving { background-color: #ffc107; color: black; transform: translateY(0); opacity: 1; }
        #save-status.success { background-color: var(--color-success); transform: translateY(0); opacity: 1; }
        #save-status.error { background-color: var(--color-primary); transform: translateY(0); opacity: 1; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed; top: 0; left: 0; height: 100%; z-index: 200;
                transform: translateX(-100%); box-shadow: 5px 0 15px rgba(0,0,0,0.2);
            }
            .sidebar.is-open { transform: translateX(0); }
            .main-header h1 { font-size: 1.2rem; }
            #mobile-menu-btn {
                display: block; background: none; border: none; color: var(--text-primary);
                font-size: 1.5rem; cursor: pointer; margin-right: 1rem;
            }
        }
    </style>
</head>
<body>

    <!-- Login Screen -->
    <div id="login-overlay">
        <div id="login-container">
            <h1>Admin Login</h1>
            <form id="login-form">
                <div class="form-group">
                    <input type="email" id="login-email" class="form-input" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="login-password" class="form-input" placeholder="Password" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
                <p id="login-error" class="error-text" style="display: none;"></p>
            </form>
        </div>
    </div>

    <!-- Main Admin Panel -->
    <div id="admin-panel">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="images/logo.png" alt="Logo">
            </div>
            <ul class="sidebar-nav" id="sidebar-nav">
                <li><a href="#" data-page="manage-courses"><i class="fa-solid fa-tasks"></i> <span>Manage Courses</span></a></li>
                <!-- Course links will be dynamically added here -->
            </ul>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div style="display: flex; align-items: center;">
                    <button id="mobile-menu-btn"><i class="fa-solid fa-bars"></i></button>
                    <h1 id="main-content-title">Manage Courses</h1>
                </div>
                <div class="header-actions">
                     <button id="save-all-changes" class="btn btn-primary btn-save" style="display: none;">Save All Changes</button>
                     <button id="logout-button" class="btn-logout">Logout</button>
                </div>
            </header>
            
            <div class="content-wrapper">
                <!-- Page View: Manage Courses -->
                <div id="manage-courses-page" class="page-view active">
                    <section class="content-section">
                        <h2>Add New Course</h2>
                        <form id="add-course-form">
                            <div class="form-group">
                                <label for="new-course-title" class="form-label">Course Title</label>
                                <input type="text" id="new-course-title" class="form-input" placeholder="e.g., Broiler Chicken Rearing" required>
                            </div>
                            <div class="form-group">
                                <label for="new-course-short-desc" class="form-label">Short Description</label>
                                <input type="text" id="new-course-short-desc" class="form-input" placeholder="A brief summary of the course" required>
                            </div>
                            <div class="form-group">
                                <label for="new-course-price" class="form-label">Price</label>
                                <input type="number" id="new-course-price" class="form-input" value="9.99" required>
                            </div>
                             <div class="form-group">
                                <label for="new-course-image" class="form-label">Image URL</label>
                                <input type="text" id="new-course-image" class="form-input" placeholder="e.g., images/broiler-card.png" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: auto;">Add Course</button>
                        </form>
                    </section>
                    <section class="content-section">
                        <h2>Existing Courses</h2>
                        <ul id="existing-courses-list" class="item-list">
                            <!-- Existing courses will be listed here -->
                        </ul>
                    </section>
                </div>

                <!-- Page View: Edit Course Details -->
                <div id="edit-course-page" class="page-view">
                    <!-- Section 1: General Information -->
                    <section class="content-section">
                        <h2>General Information</h2>
                        <div class="form-group">
                            <label for="course-title" class="form-label">Course Title</label>
                            <input type="text" id="course-title" class="form-input" placeholder="e.g., Ultimate Broiler Rearing Masterclass">
                        </div>
                        <div class="form-group">
                            <label for="course-subtitle" class="form-label">Course Subtitle</label>
                            <input type="text" id="course-subtitle" class="form-input" placeholder="e.g., From Chick to Profit in 7 Weeks">
                        </div>
                        <div class="form-group">
                            <label for="course-short-desc" class="form-label">Short Description</label>
                            <input type="text" id="course-short-desc" class="form-input" placeholder="A brief summary of the course">
                        </div>
                        <div class="form-group">
                            <label for="course-price" class="form-label">Price</label>
                            <input type="number" id="course-price" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="course-description" class="form-label">Course Description</label>
                            <textarea id="course-description" class="form-input" placeholder="Detailed description of the course. You can use <br> for line breaks."></textarea>
                        </div>
                    </section>

                    <!-- Section 2: Course Notes -->
                    <section class="content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                             <h2>Course Notes</h2>
                             <button id="add-note-card-btn" class="btn btn-primary" style="width: auto; padding: 0.6rem 1rem;">+ Add Note Section</button>
                        </div>
                        <div id="notes-container"></div>
                    </section>

                    <!-- Section 3: Video Gallery -->
                    <section class="content-section">
                        <h2>Video Gallery</h2>
                        <form id="add-video-form">
                            <div class="form-group">
                                <input type="text" id="video-title" class="form-input" placeholder="Video Title" required>
                            </div>
                            <div class="form-group">
                                <input type="url" id="video-url" class="form-input" placeholder="Full YouTube URL (e.g., https://www.youtube.com/watch?v=...)" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: auto;">+ Add Video</button>
                        </form>
                         <ul id="videos-list" class="item-list"></ul>
                    </section>
                </div>
            </div>
        </main>
    </div>
    
    <div id="save-status"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CONFIGURATION ---
        const ADMIN_EMAILS = ["admin@alfaoctal.com", "admin2@alfaoctal.com"];

        // --- DOM ELEMENTS ---
        const elements = {
            loginOverlay: document.getElementById('login-overlay'),
            loginForm: document.getElementById('login-form'),
            loginError: document.getElementById('login-error'),
            adminPanel: document.getElementById('admin-panel'),
            logoutButton: document.getElementById('logout-button'),
            saveAllButton: document.getElementById('save-all-changes'),
            saveStatus: document.getElementById('save-status'),
            sidebar: document.getElementById('sidebar'),
            sidebarNav: document.getElementById('sidebar-nav'),
            mobileMenuBtn: document.getElementById('mobile-menu-btn'),
            mainContentTitle: document.getElementById('main-content-title'),

            manageCoursesPage: document.getElementById('manage-courses-page'),
            addCourseForm: document.getElementById('add-course-form'),
            existingCoursesList: document.getElementById('existing-courses-list'),

            editCoursePage: document.getElementById('edit-course-page'),
            courseTitle: document.getElementById('course-title'),
            courseSubtitle: document.getElementById('course-subtitle'),
            courseDescription: document.getElementById('course-description'),
            notesContainer: document.getElementById('notes-container'),
            addNoteCardBtn: document.getElementById('add-note-card-btn'),
            addVideoForm: document.getElementById('add-video-form'),
            videosList: document.getElementById('videos-list'),
        };

        // --- LOCAL STATE ---
        let currentCourseData = {};
        let currentCourseId = null;
        let courseDocRef = null;

        // --- INITIALIZATION & AUTHENTICATION ---
        function init() {
            if (!window.firebase || !window.firebase.auth) {
                setTimeout(init, 100); return;
            }

            window.firebase.onAuthStateChanged(window.firebase.auth, user => {
                if (user && ADMIN_EMAILS.includes(user.email)) {
                    elements.loginOverlay.style.display = 'none';
                    elements.adminPanel.style.display = 'flex';
                    fetchAllCourses();
                    switchPage('manage-courses');
                } else {
                    elements.loginOverlay.style.display = 'flex';
                    elements.adminPanel.style.display = 'none';
                    if (user) window.firebase.signOut(window.firebase.auth);
                }
            });

            addEventListeners();
        }

        function addEventListeners() {
            elements.loginForm.addEventListener('submit', handleLogin);
            elements.logoutButton.addEventListener('click', handleLogout);
            elements.saveAllButton.addEventListener('click', saveAllChanges);
            elements.sidebarNav.addEventListener('click', handleNavClick);
            elements.mobileMenuBtn.addEventListener('click', () => elements.sidebar.classList.toggle('is-open'));

            elements.addCourseForm.addEventListener('submit', handleAddCourse);
            elements.existingCoursesList.addEventListener('click', handleDeleteCourse);

            elements.addNoteCardBtn.addEventListener('click', () => createNoteCard());
            elements.notesContainer.addEventListener('click', handleNoteCardActions);
            elements.addVideoForm.addEventListener('submit', addVideo);
            elements.videosList.addEventListener('click', e => handleDeletion(e, 'videos'));
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            elements.loginError.style.display = 'none';
            try {
                await window.firebase.signInWithEmailAndPassword(window.firebase.auth, email, password);
            } catch (error) {
                elements.loginError.textContent = "Error: " + error.message;
                elements.loginError.style.display = 'block';
            }
        }

        function handleLogout() { window.firebase.signOut(window.firebase.auth); }

        function handleNavClick(e) {
            e.preventDefault();
            const link = e.target.closest('a');
            if (!link) return;

            document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
            link.classList.add('active');
            
            const page = link.dataset.page;
            const courseId = link.dataset.courseId;
            const courseTitle = link.dataset.courseTitle;

            if (page === 'edit-course') {
                switchPage('edit-course', { courseId, courseTitle });
            } else {
                switchPage('manage-courses');
            }
            
            if (window.innerWidth <= 768) {
                elements.sidebar.classList.remove('is-open');
            }
        }
        
        // --- PAGE & DATA MANAGEMENT ---
        function switchPage(page, context = {}) {
            document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
            document.getElementById(`${page}-page`).classList.add('active');

            if (page === 'edit-course') {
                elements.mainContentTitle.textContent = `Edit: ${context.courseTitle}`;
                elements.saveAllButton.style.display = 'inline-block';
                currentCourseId = context.courseId;
                courseDocRef = window.firebase.doc(window.firebase.db, "courses", currentCourseId);
                loadCourseData();
            } else {
                elements.mainContentTitle.textContent = 'Manage Courses';
                elements.saveAllButton.style.display = 'none';
                currentCourseId = null;
                courseDocRef = null;
            }
        }

        async function fetchAllCourses() {
            try {
                const querySnapshot = await window.firebase.getDocs(window.firebase.collection(window.firebase.db, "courses"));
                const courses = [];
                querySnapshot.forEach(doc => {
                    courses.push({ id: doc.id, ...doc.data() });
                });
                renderSidebar(courses);
                renderExistingCourses(courses);
            } catch (error) {
                console.error("Error fetching courses:", error);
            }
        }

        async function handleAddCourse(e) {
            e.preventDefault();
            const titleInput = document.getElementById('new-course-title');
            const shortDescInput = document.getElementById('new-course-short-desc');
            const priceInput = document.getElementById('new-course-price');
            const imageInput = document.getElementById('new-course-image');
            const newCourse = {
                title: titleInput.value.trim(),
                shortDesc: shortDescInput.value.trim(),
                price: parseFloat(priceInput.value),
                image: imageInput.value.trim(),
                subtitle: "",
                description: "",
                notes: [],
                videos: []
            };

            try {
                await window.firebase.addDoc(window.firebase.collection(window.firebase.db, "courses"), newCourse);
                showSaveStatus("Course added successfully!", "success");
                titleInput.value = '';
                shortDescInput.value = '';
                priceInput.value = '9.99';
                imageInput.value = '';
                fetchAllCourses(); // Refresh the lists
            } catch (error) {
                console.error("Error adding course:", error);
                showSaveStatus("Error adding course.", "error");
            }
        }

        async function handleDeleteCourse(e) {
            if (!e.target.matches('.btn-delete-course')) return;
            const courseId = e.target.dataset.id;
            if (confirm(`Are you sure you want to delete this course? This action cannot be undone.`)) {
                try {
                    await window.firebase.deleteDoc(window.firebase.doc(window.firebase.db, "courses", courseId));
                    showSaveStatus("Course deleted successfully!", "success");
                    fetchAllCourses(); // Refresh the lists
                } catch (error) {
                    console.error("Error deleting course:", error);
                    showSaveStatus("Error deleting course.", "error");
                }
            }
        }


        async function loadCourseData() {
            if (!courseDocRef) return;
            try {
                const docSnap = await window.firebase.getDoc(courseDocRef);
                currentCourseData = docSnap.exists() ? docSnap.data() : { title: "", subtitle: "", description: "", notes: [], videos: [] };
                renderEditCoursePage();
            } catch (error) {
                console.error("Error loading course data:", error);
                showSaveStatus("Error loading data.", "error");
            }
        }

        async function saveAllChanges() {
            if (!courseDocRef) return;
            showSaveStatus("Saving...", "saving");
            
            const dataToSave = {
                ...currentCourseData, // Preserve existing fields like image
                title: document.getElementById('course-title').value,
                subtitle: document.getElementById('course-subtitle').value,
                shortDesc: document.getElementById('course-short-desc').value,
                price: parseFloat(document.getElementById('course-price').value),
                description: elements.courseDescription.value,
                notes: Array.from(elements.notesContainer.querySelectorAll('.note-card')).map(card => ({
                    title: card.querySelector('.note-title-input').value,
                    content: card.querySelector('.note-content-textarea').value
                })).filter(n => n.title || n.content),
                videos: currentCourseData.videos || []
            };

            try {
                await window.firebase.setDoc(courseDocRef, dataToSave, { merge: true });
                currentCourseData = dataToSave;
                showSaveStatus("Changes saved successfully!", "success");
                fetchAllCourses(); // Refresh sidebar in case title changed
            } catch (error) {
                console.error("Error saving data:", error);
                showSaveStatus("Error saving changes.", "error");
            }
        }

        // --- UI RENDERING ---
        function renderSidebar(courses) {
            const courseLinks = courses
                .sort((a, b) => a.title.localeCompare(b.title))
                .map(course => `<li><a href="#" data-page="edit-course" data-course-id="${course.id}" data-course-title="${course.title}"><i class="fa-solid fa-graduation-cap"></i> <span>${course.title}</span></a></li>`)
                .join('');

            const manageLink = `<li><a href="#" data-page="manage-courses" class="active"><i class="fa-solid fa-tasks"></i> <span>Manage Courses</span></a></li>`;
            elements.sidebarNav.innerHTML = manageLink + courseLinks;
        }

        function renderExistingCourses(courses) {
            if (courses.length === 0) {
                elements.existingCoursesList.innerHTML = '<p>No courses found. Add one above.</p>';
                return;
            }
            elements.existingCoursesList.innerHTML = courses
                .sort((a, b) => a.title.localeCompare(b.title))
                .map(course => `
                <li class="item-card">
                    <div class="item-info">
                        <strong>${course.title}</strong>
                        <span>ID: ${course.id}</span>
                    </div>
                    <button class="btn-delete btn-delete-course" data-id="${course.id}">Delete</button>
                </li>
            `).join('');
        }

        function renderEditCoursePage() {
            document.getElementById('course-title').value = currentCourseData.title || '';
            document.getElementById('course-subtitle').value = currentCourseData.subtitle || '';
            document.getElementById('course-short-desc').value = currentCourseData.shortDesc || '';
            document.getElementById('course-price').value = currentCourseData.price || '9.99';
            elements.courseDescription.value = currentCourseData.description || '';
            renderNotes();
            renderList('videos');
        }

        // --- NOTES MANAGEMENT ---
        function renderNotes() {
            elements.notesContainer.innerHTML = '';
            if (!currentCourseData.notes) currentCourseData.notes = [];
            currentCourseData.notes.forEach(note => createNoteCard(note.title, note.content));
        }
        
        function createNoteCard(title = '', content = '') {
            const card = document.createElement('div');
            card.className = 'note-card';
            card.innerHTML = `
                <div class="note-card-header">
                    <h3><input type="text" class="form-input note-title-input" placeholder="Note Section Title" value="${title}"></h3>
                    <div class="note-card-actions">
                        <button class="btn-delete-note" title="Delete Note"><i class="fa-solid fa-trash"></i></button>
                        <i class="fa-solid fa-chevron-down toggle-icon"></i>
                    </div>
                </div>
                <div class="note-card-body">
                    <div class="form-group">
                        <textarea class="form-input note-content-textarea" placeholder="Write your notes here... You can use HTML tags like <br> for line breaks.">${content}</textarea>
                    </div>
                </div>
            `;
            elements.notesContainer.appendChild(card);
        }
        
        function handleNoteCardActions(e) {
            const header = e.target.closest('.note-card-header');
            const deleteBtn = e.target.closest('.btn-delete-note');
            
            if (deleteBtn) {
                if (confirm('Are you sure you want to delete this note section?')) {
                    deleteBtn.closest('.note-card').remove();
                }
                return;
            }

            if (header) {
                header.parentElement.classList.toggle('is-open');
            }
        }

        // --- VIDEO & GENERIC LIST MANAGEMENT ---
        function addVideo(e) {
            e.preventDefault();
            const titleInput = document.getElementById('video-title');
            const urlInput = document.getElementById('video-url');
            if (!currentCourseData.videos) currentCourseData.videos = [];

            const newVideo = {
                id: Date.now().toString(),
                title: titleInput.value,
                url: urlInput.value
            };
            currentCourseData.videos.push(newVideo);
            renderList('videos');
            e.target.reset();
        }

        function renderList(type) {
            const listElement = elements[`${type}List`];
            if (!listElement) return;
            listElement.innerHTML = ''; 
            if (!currentCourseData[type]) currentCourseData[type] = [];

            currentCourseData[type].forEach(item => {
                const card = document.createElement('li');
                card.className = 'item-card';
                card.innerHTML = `
                    <div class="item-info">
                        <strong>${item.title}</strong>
                        <span>${item.description || item.url}</span>
                    </div>
                    <button class="btn-delete" data-id="${item.id}" data-type="${type}">Delete</button>
                `;
                listElement.appendChild(card);
            });
        }
        
        function handleDeletion(event) {
            const target = event.target.closest('.btn-delete');
            if (!target) return;

            const listType = target.dataset.type;
            const idToDelete = target.dataset.id;
            
            if (confirm("Are you sure you want to delete this item?")) {
                currentCourseData[listType] = currentCourseData[listType].filter(item => item.id !== idToDelete);
                renderList(listType);
            }
        }

        // --- UTILITY ---
        function showSaveStatus(message, status) { 
            elements.saveStatus.textContent = message;
            elements.saveStatus.className = status;
            if (status === 'success' || status === 'error') {
                setTimeout(() => { elements.saveStatus.className = ''; }, 3000);
            }
        }

        init();
    });
    </script>
</body>
</html>
